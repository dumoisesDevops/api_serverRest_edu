name: End-to-end API tests  # Nome do pipeline

on: push  # O pipeline será acionado em um push

jobs:
  api-tests:
    runs-on: ubuntu-latest  # Usando uma imagem do Ubuntu para rodar os testes de API

    strategy:
      matrix:
        test-file: [login/login.cy.js, produtos/produto.cy.js, usuario/usuario.cy.js]  # Arquivos de teste a serem executados em paralelo

    steps:
      - name: Checkout code  # Faz o checkout do repositório
        uses: actions/checkout@v4

      - name: Set up Node.js  # Configura Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'  # Versão do Node.js a ser usada

      - name: Install dependencies  # Instala as dependências do projeto
        run: npm install

      - name: Run API test on ${{ matrix.test-file }}  # Roda os testes de API para o arquivo específico
        run: npm run test:api -- "cypress/e2e/${{ matrix.test-file }}"  # Correção aqui
      
      - name: Upload Test Results  # Faz o upload dos resultados dos testes
        uses: actions/upload-artifact@v4
        with:
          name: api-test-results-${{ matrix.test-file }}  # Nome do artefato com o nome do arquivo de teste
          path: results/

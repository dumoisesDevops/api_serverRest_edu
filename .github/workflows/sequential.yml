name: End-to-end tests

on: 
  push:
    branches:
      - main

jobs:
  cypress-run:
    runs-on: ubuntu-latest

    steps:
      # Passo 1: Checkout do código
      - name: Checkout
        uses: actions/checkout@v4

      # Passo 2: Instalar Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16.x' # Certifique-se de usar uma versão compatível com o projeto

      # Passo 3: Instalar dependências do projeto
      - name: Install dependencies
        run: npm install

      # Passo 4: Executar testes Cypress com Allure
      - name: Run Cypress tests
        run: npx cypress run --env allure=true

      # Passo 5: Instalar Allure CLI para gerar relatórios
      - name: Install Allure CLI
        run: npm install -g allure-commandline --save-dev

      # Passo 6: Gerar relatório Allure
      - name: Generate Allure report
        run: allure generate allure-results --clean -o allure-report

      # Passo 7: Upload do relatório Allure como artefato
      - name: Upload Allure report
        uses: actions/upload-artifact@v3
        with:
          name: allure-report
          path: allure-report

      # Passo 8: Publicar resultados de testes (JUnit)
      - name: Publish Test Results
        uses: actions/upload-artifact@v3
        with:
          name: test-results
          path: results/output.xml
